<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>Register</title>
    <!-- Favicon -->
    <link rel="icon" href="../img/brand/favicon.png" type="image/png" />
    <!-- Font Awesome 5 -->
    <link
      rel="stylesheet"
      href="../libs/@fortawesome/fontawesome-free/css/all.min.css"
    />
    <!-- Purpose CSS -->
    <link rel="stylesheet" href="../css/purpose.css" id="stylesheet" />
  </head>

  <body class="application application-offset">
    <!-- Application container -->
    <div class="container-fluid container-application">
      <div class="main-content position-relative">
        <!-- Page content -->
        <div class="page-content">
          <div class="min-vh-100 py-5 d-flex align-items-center">
            <div style="width: 100vw">
              <div class="row justify-content-center">
                <div class="col-7">
                  <div class="card shadow zindex-100 mb-0">
                    <div class="card-body px-md-5 py-5">
                      <div class="mb-5">
                        <h6 class="h3">Create Account</h6>
                        <p class="text-muted mb-0">
                          Create your account to continue.
                        </p>
                      </div>
                      <span class="clearfix"></span>

                      <form>
                        <!-- General information -->
                        <div class="row">
                          <div class="col-md-6">
                            <div class="form-group">
                              <label class="form-control-label"
                                >First name</label
                              >
                              <input
                                class="form-control"
                                type="text"
                                name="firstName"
                                id="firstName"
                                required
                                placeholder="Enter your first name"
                              />
                            </div>
                          </div>
                          <div class="col-md-6">
                            <div class="form-group">
                              <label class="form-control-label"
                                >Last name</label
                              >
                              <input
                                class="form-control"
                                type="text"
                                name="lastName"
                                id="lastName"
                                required
                                placeholder="Also your last name"
                              />
                            </div>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-md-6">
                            <div class="form-group">
                              <label class="form-control-label"
                                >Email address</label
                              >
                              <div class="input-group input-group-merge">
                                <div class="input-group-prepend">
                                  <span class="input-group-text"
                                    ><i class="fas fa-envelope"></i
                                  ></span>
                                </div>
                                <input
                                  type="email"
                                  name="email"
                                  class="form-control"
                                  id="email"
                                  required
                                  placeholder="name@example.com"
                                />
                              </div>
                              <div style="margin-top: 0.5rem">
                                <span
                                  class="badge badge-danger email-error"
                                  style="font-weight: 400"
                                >
                                </span>
                              </div>
                            </div>
                          </div>
                          <div class="col-md-6">
                            <div class="form-group mb-4">
                              <div
                                class="d-flex align-items-center justify-content-between"
                              >
                                <div>
                                  <label class="form-control-label"
                                    >Password</label
                                  >
                                </div>
                              </div>
                              <div class="input-group input-group-merge">
                                <div class="input-group-prepend">
                                  <span class="input-group-text"
                                    ><i class="fas fa-key"></i
                                  ></span>
                                </div>
                                <input
                                  type="password"
                                  class="form-control"
                                  id="password"
                                  name="password"
                                  required
                                  placeholder="Password"
                                />
                                <div class="input-group-append">
                                  <span class="input-group-text">
                                    <a
                                      href="#"
                                      data-toggle="password-text"
                                      data-target="#input-password"
                                    >
                                      <i class="fas fa-eye"></i>
                                    </a>
                                  </span>
                                </div>
                              </div>
                              <div style="margin-top: 0.5rem">
                                <span
                                  class="badge badge-danger password-error"
                                  style="font-weight: 400"
                                >
                                </span>
                              </div>
                            </div>
                          </div>
                        </div>

                        <div class="row">
                          <div class="col-md-6">
                            <div class="form-group">
                              <label class="form-control-label">Username</label>
                              <div class="input-group input-group-merge">
                                <div class="input-group-prepend">
                                  <span class="input-group-text"
                                    ><i class="fas fa-user"></i
                                  ></span>
                                </div>
                                <input
                                  type="text"
                                  name="username"
                                  class="form-control"
                                  id="username"
                                  required
                                  placeholder="mario_123"
                                />
                              </div>
                              <div style="margin-top: 0.5rem">
                                <span
                                  class="badge badge-danger username-error"
                                  style="font-weight: 400"
                                >
                                </span>
                              </div>
                            </div>
                          </div>
                          <div class="col-md-6">
                            <div class="form-group">
                              <label class="form-control-label">Title</label>
                              <div class="input-group input-group-merge">
                                <div class="input-group-prepend">
                                  <span class="input-group-text"
                                    ><i class="fas fa-user"></i
                                  ></span>
                                </div>
                                <input
                                  type="text"
                                  name="title"
                                  class="form-control"
                                  id="title"
                                  required
                                  placeholder="Web Developer"
                                />
                              </div>
                              <div style="margin-top: 0.5rem">
                                <span
                                  class="badge badge-danger title-error"
                                  style="font-weight: 400"
                                >
                                </span>
                              </div>
                            </div>
                          </div>
                        </div>

                        <div class="row">
                          <div class="col-md-6">
                            <div class="form-group">
                              <label class="form-control-label">Phone</label>
                              <input
                                class="form-control"
                                type="text"
                                required
                                name="phone"
                                id="phone"
                                placeholder="+40-777 245 549"
                              />
                            </div>
                          </div>
                        </div>
                        <hr />

                        <!-- Description -->
                        <div class="row">
                          <div class="col">
                            <div class="form-group">
                              <div class="form-group">
                                <label class="form-control-label">Bio</label>
                                <textarea
                                  class="form-control"
                                  placeholder="Tell us a few words about yourself"
                                  rows="3"
                                  name="bio"
                                  id="bio"
                                ></textarea>
                                <small class="form-text text-muted mt-2"
                                  >You can @mention other users and
                                  organizations to link to them.</small
                                >
                              </div>
                            </div>
                          </div>
                        </div>

                        <hr />
                        <input
                          type="submit"
                          class="btn btn-sm btn-primary rounded-pill"
                          value="Create Account"
                        />
                      </form>
                    </div>
                    <div class="card-footer px-md-5">
                      <small>Already registered?</small>
                      <a href="/signup" class="small font-weight-bold"
                        >Sign In</a
                      >
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Footer -->
      </div>
    </div>
    <!-- Scripts -->
    <!-- Core JS - includes jquery, bootstrap, popper, in-view and sticky-kit -->
    <script src="../js/purpose.core.js"></script>
    <!-- Purpose JS -->
    <script src="../js/purpose.js"></script>
    <!-- Demo JS - remove it when starting your project -->
    <script src="../js/demo.js"></script>
  </body>
</html>

<script>
  const form = document.querySelector("form");
  const emailError = document.querySelector(".email-error");
  const passwordError = document.querySelector(".password-error");
  const usernameError = document.querySelector(".username-error");
  const titleError = document.querySelector(".title-error");

  emailError.style.display = "none";
  passwordError.style.display = "none";
  usernameError.style.display = "none";
  titleError.style.display = "none";

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    // reset errors
    emailError.textContent = "";
    passwordError.textContent = "";
    usernameError.textContent = "";
    titleError.textContent = "";

    // get values
    const email = form.email.value;
    const password = form.password.value;
    const username = form.username.value;
    const firstName = form.firstName.value;
    const lastName = form.lastName.value;
    const phone = form.phone.value;
    const bio = form.bio.value;
    const title = form.title.value;

    try {
      console.log(bio);
      const res = await fetch("/signup", {
        method: "POST",
        body: JSON.stringify({
          username,
          email,
          password,
          firstName,
          lastName,
          phone,
          bio,
          title,
        }),
        headers: { "Content-Type": "application/json" },
      });
      const data = await res.json();

      if (data.errors) {
        console.log(data);
        if (data.errors.email.length > 0) {
          emailError.textContent = data.errors.email;
          emailError.style.display = "inline-block";
        } else if (data.errors.title.length > 0) {
          titleError.textContent = data.errors.title;
          titleError.style.display = "inline-block";
        } else {
          passwordError.textContent = data.errors.password;
          passwordError.style.display = "inline-block";
        }
      }
      if (data.user) {
        location.assign("/smoothies");
      }
    } catch (err) {
      console.log(err);
    }
  });
</script>
